<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{admin/layout/default}">
	  

	  
<th:block layout:fragment="customContents">

     <div class="container-fluid">
       <div class="row justify-content-center">
          <div class="col-12">
          <a class="return-tag" href="/admin/cup/discardCupManage">íê¸°ì»µ ê´€ë¦¬</a>
              <div class="row my-4">
                <!-- Small table -->
                <div class="col-md-12">
                  <div class="card shadow">
                    <div class="card-body">
                     <div class="download-file-discardForm">
                    	<table class="table table-borderless">
                    		<thead>
                    			<tr>
	                    		<th  colspan="4">
	                     			<p class="upload-file-discard-p">ğŸ’¦ì„¸ì²™ì—…ì²´ì—ê²Œ í˜„ì¬ ì˜¬ë ¤ì¤€ íŒŒì¼</p>
	                     		</th>
	                     		</tr>
							</thead>
							<tbody class="discard-height">
								<tr  th:if="${not #lists.isEmpty(fileList)}" th:each="l, index : ${fileList}">
									<td th:text="${index.count}"></td>
									<td colspan="2" th:text="${l.fileOriginalName}"></td>
									
									<td class="td-class-file">
										<a class="btn mb-2 btn-light" th:href="@{/admin/cup/file/download(fileIdx=${l.fileIdx})}">ë‹¤ìš´ë¡œë“œ</a>
										<a class="delete-file btn mb-2 btn-light" th:href="@{#}" th:data-file-idx="${l.fileIdx}">ì‚­ì œ</a>
									</td>
								</tr>
								<tr th:unless="${not #lists.isEmpty(fileList)}">
									<td colspan="4">ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td>
								</tr>
							</tbody>
						</table>
					</div>
                     <div class="upload-file-discardForm">
                    	<form id="fileUploadForm" th:action="@{/admin/cup/file/upload}" method="post" enctype="multipart/form-data">
                    		<table class="table table-borderless">
                    		<thead>
                    			<tr>
	                    		<th  colspan="2">
	                     			<p class="upload-file-discard-p">ğŸ’¦ì„¸ì²™ì—…ì²´ê°€ ë‹¤ìš´ ë°›ì•„ì•¼ í•˜ëŠ” íŒŒì¼ ì—…ë¡œë“œ</p>
	                     		</th>
	                     		</tr>
							</thead>
                    		<tbody>
                    			<tr>
                    			<td>
									<input type="file" name="uploadfile" multiple="multiple"/>
								</td>
								<td class="td-class-file">
								<button id="fileUploadBtn" class="btn mb-2 btn-light" type="button">ì—…ë¡œë“œ</button>
								</td>
								</tr>
                    		</tbody>
							</table>
						</form>
					</div>
                      <!-- table -->
                      <table class="table datatables table-hover" id="dataTable-1">
                      <thead>
                          <tr>
                           <th>
                            	<div class="custom-control custom-checkbox">
	                               <input type="checkbox" class="custom-control custom-checkbox checkbox allCheck" >
                              	</div>
                            </th>
                            <th>NO.</th>
                           	<th>ì‚¬ì—…ì¥ ì½”ë“œ</th>
                            <th>ì»µ QR</th>
                            <th>ì—…ë°ì´íŠ¸ ë‚ ì§œ</th>
                            <th>ê´€ë¦¬ì ID</th>
                          </tr>
                        </thead>
                        <tbody>
                        	<th:block th:unless="${#lists.isEmpty(discardCupList)}"  th:each="d,state : ${discardCupList}">
		                          <tr>
		                            <td>
		                              <div class="custom-control custom-checkbox">
		                                <input type="checkbox" class="custom-control custom-checkbox checkbox checks" th:data-cup-qr="${d.cupQR}">
		                              </div>
		                            </td>
		                            <td th:text="${d.num}"></td>
		                            <td th:text="${d.partnerInfo}"></td>
		                            <td th:text="${d.cupQR}"></td>
		                            <td th:text="${d.upDateTime}"></td>
		                            <td th:text="${d.userId}"></td>
		                          </tr>
                          	</th:block>
                          	<tr th:if="${#lists.isEmpty(discardCupList)}">
								<td colspan="6">íê¸°ì»µì´ ì—†ìŠµë‹ˆë‹¤.</td>
	              			</tr>
                        </tbody>
                      </table>
                      <div class="colSpan-left">
                     	 <button type="button" class="btn mb-2 btn-secondary" id="delCheckBtn" >ì‚­ì œ</button>
                      </div>
                    </div>
                  </div>
                </div> <!-- simple table -->
              </div> <!-- end section -->
            </div> <!-- .col-12 -->
           </div>
          </div>
	</th:block>
	<th:block layout:fragment="customJs">
		<script type="text/javascript" th:inline="javascript">
		/* 	let msg = '[[${msg}]]';
			console.log(msg);
			if(msg != 'null') alert(msg);
			 */
			$(function(){
		      $('#dataTable-1').DataTable({
			        autoWidth: true,
			        "lengthChange": false, 
	                 "pageLength" : 15,
	                 "searching" : false,
	                 "info": false,
			        columnDefs: [{
			            targets: 0,
			            searchable: false,
			            orderable: false,
			            className: 'sorting_disabled'
			            
			         }
			         ,{
			            targets: $('#dataTable-1').find('th').length-1,
			            searchable: false,
			            orderable: false,
			            className: 'sorting_disabled',	           
			         	}
			         ]
						      	
				});
			$('#dataTable-1').find('.sorting_asc').toggleClass('sorting_asc');
			});
			
			 $('table').click((e) => {
			        if ($(e.target).is($('.allCheck'))) {
			          const isChecked = $(e.currentTarget)
			            .find('.allCheck')
			            .prop('checked');
			          $(e.currentTarget).find('.checks').prop('checked', isChecked);
			        }
			
			        if ($(e.target).is($('.checks'))) {
			          if (
			            $(e.currentTarget).find('.checks').length ==
			            $(e.currentTarget).find('.checks:checked').length
			          ) {
			            $(e.currentTarget).find('.allCheck').prop('checked', true);
			          } else $(e.currentTarget).find('.allCheck').prop('checked', false);
			        }
			      });
			
			 //ì‚­ì œì²˜ë¦¬
			 $('#delCheckBtn').click(function(e){
				  //ë°°ì—´ ì„ ì–¸
					const cupQrArr = [];
				  //check í´ë˜ìŠ¤ ì¤‘ ì†ì„±ì´ checkedëœ ìš”ì†Œë§Œ ë³€ìˆ˜ì— ë‹´ì•„ì¤Œ
					const $checkedEle = $('.checks:checked');
				  //ë°°ì—´ ìˆœíšŒ
					$checkedEle.each((idx, item) => {
						//inputíƒœê·¸ì— ì†ì„±ì¸ th:data-cup-qr (cup-qrì€ ìë™ìœ¼ë¡œ cupQrë¡œ ë³€í™˜)
						let cupQr = $(item).data('cupQr');
						//ë² ì—´ì— cupQr ë‹´ì•„ì¤Œ
						cupQrArr.push(cupQr);
					})
					console.log(cupQrArr);
				  	//ë°°ì—´ì˜ ê¸¸ì´ê°€ 0ì´ ì•„ë‹ˆë©´
					if(cupQrArr.length != 0){
						//ìƒˆë¡œìš´ í¼ ìƒì„± ->jquery
						const newForm = $('<form></form>');
						//ìƒˆë¡œìš´ í¼ì— set attribute	
						newForm.attr("method","post");
						newForm.attr("action","/admin/cup/discardCupRemove");
						// create element & set attribute (input)
						//$ ì œì´ì¿¼ë¦¬ ë°°ì—´ì„ ìˆœíšŒí•˜ëŠ”ë° ìˆœíšŒí•˜ëŠ” ë°°ì—´ì€ ê´„í˜¸ ì•ˆìª½ì—ì„œ ë¶€ë¦„
						$.each(cupQrArr, (idx, item) => {
							newForm.append($('<input/>', {type: 'hidden', name: 'cupQR', value:item}));
						})
						// append form (to body) 
						// newFormì€ ì´ë¯¸ ì œì´ì¿¼ë¦¬ ë¬¸ë²•ìœ¼ë¡œ ì„ ì–¸
						newForm.appendTo('body');
						let result = confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")
						if(result){
							alert("ì‚­ì œ ì™„ë£Œ!!")
							newForm.submit();
						}else alert("ì·¨ì†Œ ë˜ì—ˆìŠµë‹ˆë‹¤.")
			
					}
				});	
			 //ì„ íƒëœ íŒŒì¼ì´ ìˆì„ ë•Œë§Œ submit
			 $('#fileUploadBtn').click(function(e){
				 
				 const $fileUploadVal = $('#fileUploadForm input').val()
				 console.log($fileUploadVal);
					if($fileUploadVal){
					 $('#fileUploadForm').submit();
			 	 }else{
			 		 alert("ì—…ë¡œë“œ í•  íŒŒì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”!")
			 	 }
			 });
			 //ì²¨ë¶€íŒŒì¼ ì‚­ì œ
			 const $deleteAEles = document.querySelectorAll('.delete-file');
				
				$deleteAEles.forEach(item => {
					item.addEventListener('click', function(e){
						e.preventDefault();
						let isDelete = confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')
						if(isDelete){					
							const fileIdx = this.dataset.fileIdx;
							location.href = `/admin/cup/file/deleteFile?fileIdx=${fileIdx}`;
						}
					});
				});
		</script>
	</th:block>
</html>




